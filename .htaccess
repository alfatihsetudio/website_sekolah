# web_MG/.htaccess - minimal & safe
RewriteEngine On
RewriteBase /web_MG/

# Direct requests to uploads/materials/* go to serve_file.php
# Put this rule FIRST so it runs before any deny rules
RewriteRule ^uploads/materials/(.*)$ /web_MG/serve_file.php?f=materials/$1 [L,QSA]

# Disable directory listing
Options -Indexes

# Block execution of scripts in uploads folder
<If "%{REQUEST_URI} =~ m#^/web_MG/uploads/#">
    <FilesMatch "\.(php|phps|phtml|pl|py|jsp|asp|sh)$">
        Require all denied
    </FilesMatch>
</If>

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>
